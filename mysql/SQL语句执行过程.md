## 一条SQL语句的执行过程

图示
![query_process](mysql/image/query_process.png)

### 连接器

连接器和客户端建立连接，校验权限，管理连接；权限修改对已经存在的连接无效

show processlist 查看连接列表 Sleep状态表示连接闲置

建立连接过程复杂，推荐使用长连接

语句执行中，临时使用的内存保存在连接对象里，时间长了可能导致占用大量内存，可以用函数mysql_reset_connection重置连接

### 查询缓存

查询语句和查询结果以key-value方式缓存起来，如果表被更新，则所有相关的缓存失效

查询缓存一般情况下命中率不高，不推荐使用，（query_cache_type=DEMAND 不开启）

MySQL8.0已经把查询缓存功能删除了

### 分析器

对SQL语句解析，词法分析->语义解析（表名，列名和实际对应）->语法校验；解析出SQL语句的行为目的

### 优化器

决定SQL语句执行策略，比如查表顺序，选哪个索引

### 执行器

执行前先检查权限

调引擎接口获取可能符合条件的行，每检查一行，慢查询日志rows_examined加一；但是有些场景下执行器调用一次，存储引擎扫描了多行；所以rows_examined可能不完全等于SQL语句执行中总共扫描了多少行。


